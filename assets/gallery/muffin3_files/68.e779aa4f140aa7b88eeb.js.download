(window.webpackJsonp=window.webpackJsonp||[]).push([[68],{491:function(e,t,n){"use strict";n.r(t),n.d(t,"searchByImageInitialize",(function(){return B}));n(9),n(65),n(14),n(3),n(715),n(723),n(725),n(726),n(728),n(731),n(732),n(733),n(734),n(735),n(736),n(737),n(738),n(740),n(741),n(742),n(743),n(744),n(745),n(746),n(747),n(748),n(749),n(18),n(16),n(251),n(186),n(5);var r,a=n(0),i=function(){var e=Object(a.d)('[data-search="image"]');e.length>0&&e.forEach((function(e){return function(e){var t=BASE64_SEARCH_BY_IMAGE;if(t&&t.split(",").length>0){for(var n=atob(t.split(",")[1]),r=new Uint8Array(n.length),a=0;a<n.length;a++)r[a]=n.charCodeAt(a);var i=URL.createObjectURL(new Blob([r],{type:"image/png"}));e.style.backgroundImage="url("+i+")"}}(e)}))},c=n(80),s=n(2),o=n(1),u=n.n(o),d=(n(15),n(343)),l=(n(84),n(98),n(289)),h=function(){var e=Object(s.a)(u.a.mark((function e(t,r){var a,i;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.e(141).then(n.t.bind(null,872,7));case 2:return a=e.sent,i=a.default,e.next=6,i().resize(t,r,{unsharpAmount:80,unsharpRadius:.6,unsharpThreshold:2});case 6:return e.abrupt("return",r);case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),f=function(e){return new Promise((function(t,n){var r=new Image;r.src=URL.createObjectURL(e),r.onload=function(){t(r)},r.onerror=n}))},p=(n(47),function(){var e=Object(s.a)(u.a.mark((function e(t,n){var r,i,c;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t.toDataURL(n,l.j),i=Object(a.c)("#"+l.a),c=Object(a.c)("#"+l.l),i.value=r.replace("data:"+n+";base64,",""),c.value=n;case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),v=function(e){var t=window.URL.createObjectURL(e),n=Object(a.c)("#"+l.n);n&&t&&(n.style.backgroundImage="url("+t+")")},m=function(e){var t=document.createElement("canvas"),n=l.i,r=l.i;if(e.width!==e.height){var a=Math.min(e.width,e.height)/l.i;n=Math.round(e.width/a),r=Math.round(e.height/a),e.width>e.height?(n=Math.min(n,l.h),r=Math.round(n*(e.height/e.width))):(r=Math.min(r,l.h),n=Math.round(r*(e.width/e.height)))}return t.width=n,t.height=r,t},b=function(){var e=Object(s.a)(u.a.mark((function e(t){var n,r,a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l.k.includes(t.type)){e.next=2;break}throw new Error("Invalid file type");case 2:if(!(t.size>l.f)){e.next=4;break}throw new Error("Invalid file size");case 4:return e.prev=4,v(t),e.next=8,f(t);case 8:if(!((n=e.sent).width<l.i||n.height<l.i)){e.next=11;break}throw new Error("Invalid file min dimensions");case 11:return r=m(n),e.next=14,h(n,r);case 14:a=e.sent,p(a,t.type),e.next=22;break;case 18:throw e.prev=18,e.t0=e.catch(4),console.error("Error trying to process the file:",e.t0),e.t0;case 22:case"end":return e.stop()}}),e,null,[[4,18]])})));return function(t){return e.apply(this,arguments)}}(),g=n(4),w={"Invalid file min dimensions":{message:Object(g.a)(l.b,l.i,l.i),event:"dimension"},"Invalid file size":{message:Object(g.a)(l.c,l.g),event:"size"},"Invalid file type":{message:Object(g.a)(l.d,l.p[0],l.p[1]),event:"format"}},I=function(){var e=Object(a.c)("#"+l.o);return{form:Object(a.c)("#"+l.m),errorElement:Object(a.c)(".form-alert",e)}},j=function(){var e=I().errorElement;e&&e.classList.add("hide")},O=function(e){var t,n=I(),r=n.errorElement,i=n.form;if(r){var c=Object(a.c)("span",r);if(c){var s=(null===(t=w[e.message])||void 0===t?void 0:t.message)||"Error";c.textContent=s,r.classList.remove("hide"),i.classList.remove("is-uploading"),Object(a.c)("#"+l.a).value=""}}},E=n(6),L=function(e){var t=Object(E.getRandomRange)(0,l.s.length-1);e.textContent=Object(g.a)(l.s[t])},y=function(){var e=document.getElementById(l.t);e&&(Object(a.c)("#"+l.m).classList.add("is-uploading"),L(e),r=setInterval((function(){return L(e)}),l.r))},x=(n(20),n(28)),k=function(e,t){Object(x.a)({description:e,options:Object.assign({},t||{})})},_=function(){var e=Object(s.a)(u.a.mark((function e(t){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,r&&clearInterval(r),j(),t){e.next=5;break}throw new Error("Invalid file type");case 5:return y(),e.next=8,b(t);case 8:(n=Object(a.c)("#"+l.e))&&(n.value=""),d.a.goToSearchByImage(),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(0),O(e.t0),k("searchImageError",{type:e.t0.message?w[e.t0.message].event:"Error"});case 17:case"end":return e.stop()}}),e,null,[[0,13]])})));return function(t){return e.apply(this,arguments)}}(),T=function(e){e.preventDefault(),e.stopPropagation()};function R(e){T(e),this.classList.contains("is-uploading")||this.classList.add("is-dragover")}function M(e){T(e),this.classList.remove("is-dragover")}function S(e){return U.apply(this,arguments)}function U(){return(U=Object(s.a)(u.a.mark((function e(t){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(T(t),!this.classList.contains("is-uploading")){e.next=3;break}return e.abrupt("return");case 3:this.classList.remove("is-dragover"),n=t.dataTransfer&&t.dataTransfer.files[0],k("searchImageSelection",{type:"drop"}),_(n);case 7:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}var A=function(e){var t,n,r=Object(a.c)("form",e);r&&(null===(t=Object(a.c)("#"+l.e))||void 0===t||t.addEventListener("change",(function(e){var t,n=null===(t=e.target.files)||void 0===t?void 0:t[0];_(n),k("searchImageSelection",{type:"select"})})),("draggable"in(n=document.createElement("div"))||"ondragstart"in n&&"ondrop"in n)&&"FileReader"in window&&(r.classList.add("is-dragndrop-enabled"),r.addEventListener("dragover",R),r.addEventListener("dragleave",M),r.addEventListener("drop",S)))},C=function(){var e=Object(s.a)(u.a.mark((function e(){var t,r,i,s,o,d;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Object(a.c)("#"+l.o)){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,n.e(84).then(n.t.bind(null,871,7));case 4:t=e.sent,r=t.default,i=Object(c.a)(),s=i.format,o=i.base64,(d=a.e.ModalInstance.print({name:"search-by-image",html:r({CSRF_TOKEN:CSRF_TOKEN,URL_STATIC_IMG:URL_STATIC_IMG,FILE_MIN_WIDTH_HEIGHT:l.i,FILE_MAX_SIZE_WITH_UNITS:l.g,TEXT_VALID_TYPES:l.p.join(", "),base64:o,format:s})},!1))&&(A(d),d.addEventListener("hide",j));case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),B=function(){var e;(e=Object(a.d)('[data-modal="'+l.q+'"]')).length>0&&e.forEach((function(e){e.addEventListener("click",Object(s.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return k("searchImage"),C(),e.next=4,n.e(51).then(n.bind(null,870));case 4:(0,e.sent.searchByImageShowModal)(),k("searchImageModal");case 8:case"end":return e.stop()}}),e)}))))})),Object(c.b)()&&(C(),i())}}}]);
//# sourceMappingURL=68.88be6362c3dfac64a1abc09f48a29d09.js.map